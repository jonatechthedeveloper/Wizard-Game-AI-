<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizard Adventure</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        
        #game-container {
            width: 164px;
            height: 164px;
            position: relative;
        }
        
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        #joystick-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: none;
            z-index: 5;
        }
        
        .joystick {
            width: 100px;
            height: 100px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            position: relative;
        }
        
        .joystick-knob {
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            position: absolute;
            top: 30px;
            left: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 text-center">
                <div id="game-container">
                    <div id="start-screen">
                        <button id="play-btn" class="btn btn-primary">Play</button>
                    </div>
                </div>
                <div id="joystick-container">
                    <div class="joystick">
                        <div class="joystick-knob"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const isAndroid = /Android/i.test(navigator.userAgent);
        
        document.getElementById('play-btn').addEventListener('click', function() {
            document.getElementById('start-screen').style.display = 'none';
            if (isAndroid) {
                document.getElementById('joystick-container').style.display = 'block';
            }
            startGame();
        });

        function startGame() {
            const config = {
                type: Phaser.AUTO,
                width: 164,
                height: 164,
                parent: 'game-container',
                pixelArt: true,
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 0 },
                        debug: false
                    }
                },
                scene: {
                    preload: preload,
                    create: create,
                    update: update
                }
            };

            const game = new Phaser.Game(config);
            let wizard;
            let cursors;
            let wasdKeys;
            let apples;
            let enemies;
            let healthText;
            let health = 0;
            let gameOver = false;
            let victoryScreen;
            let defeatScreen;
            let joystick = { isActive: false, x: 0, y: 0 };
            
            function preload() {
                // Load wizard spritesheet
                this.load.spritesheet('wizard', 'openartimage_HdbJLJoD_1743849908086_raw.jpg', { 
                    frameWidth: 82, 
                    frameHeight: 139 
                });
                
                // Load apple sprite
                this.load.image('apple', 'sr25fab978dc2aws3.png');
                
                // Load basic shapes for enemies
                this.load.image('redBlock', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjFBRTMxQTFBRTY0OTExRThBN0NDQzQyMTMyNzlDNjE3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjFBRTMxQTFCRTY0OTExRThBN0NDQzQyMTMyNzlDNjE3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MUFFMzFBMThFNjQ5MTFFOEEwN0NDQzQyMTMyNzlDNjE3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjFBRTMxQTE5RTY0OTExRThBN0NDQzQyMTMyNzlDNjE3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+TEHKwQAAADJJREFUeNpi/P//PwMlgImBQsASGRnJCKKBfBaK7YCKf4NoBgYGig3AwrgeGMl8YAAwANVbChQdX1VwAAAAAElFTkSuQmCC');
                this.load.image('greenBlock', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjIwRDk1RUJBRTdGQjExRTg5QkNEREREQTg5RDk3NjdFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjIwRDk1RUJCRTdGQjExRTg5QkNEREREQTg5RDk3NjdFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MjBEOTVFQjhFN0ZCMTFFODlCQ0REREFEOUU5RDk3NjdFIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjIwRDk1RUI5RTdGQjExRTg5QkNEREREQTg5RDk3NjdFIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+SASSBgAAADNJREFUeNpi/P//PwMlgImBQsACYkRGRoJoIJ+FYjugYqDtDAwMFBuAhXE9MJL5wAAYAAQYAGCTCP45k/0TAAAAAElFTkSuQmCC');
                
                // Load particle
                this.load.image('particle', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjEzNkQyQjI3RTdGQjExRThCMjI0RDk1MTFFM0I1QTVDIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjEzNkQyQjI4RTdGQjExRThCMjI0RDk1MTFFM0I1QTVDIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MTM2RDJCMjVFN0ZCMTFFOEIyMjREOTUxMUUzQjVBNUMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MTM2RDJCMjZFN0ZCMTFFOEIyMjREOTUxMUUzQjVBNUMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDwvP3hwYWNrZXQgZW5kPSJyIj8+ZIgGbgAAAEFJREFUeNpi/P//PwMQHwfiF0D8B4hfAvFJIG5lwqIOCBhBHJj4v5EZQLo/MP5HY4MUfoUoBOEfQHwMiD9BFQIEGABwhSRZMJ7oagAAAABJRU5ErkJggg==');
            }
            
            function create() {
                // Create the wizard sprite with transparent background
                wizard = this.physics.add.sprite(82, 82, 'wizard');
                wizard.setScale(0.4);
                
                // Set transparent background for wizard sprite
                wizard.setTint(0xFFFFFF);
                
                // Create animations for wizard
                this.anims.create({
                    key: 'left',
                    frames: this.anims.generateFrameNumbers('wizard', { start: 0, end: 1 }),
                    frameRate: 5,
                    repeat: -1
                });
                
                this.anims.create({
                    key: 'right',
                    frames: this.anims.generateFrameNumbers('wizard', { start: 2, end: 3 }),
                    frameRate: 5,
                    repeat: -1
                });
                
                this.anims.create({
                    key: 'up',
                    frames: this.anims.generateFrameNumbers('wizard', { start: 4, end: 5 }),
                    frameRate: 5,
                    repeat: -1
                });
                
                this.anims.create({
                    key: 'down',
                    frames: this.anims.generateFrameNumbers('wizard', { start: 6, end: 7 }),
                    frameRate: 5,
                    repeat: -1
                });
                
                // Set up keyboard controls
                cursors = this.input.keyboard.createCursorKeys();
                wasdKeys = this.input.keyboard.addKeys({
                    up: Phaser.Input.Keyboard.KeyCodes.W,
                    down: Phaser.Input.Keyboard.KeyCodes.S,
                    left: Phaser.Input.Keyboard.KeyCodes.A,
                    right: Phaser.Input.Keyboard.KeyCodes.D,
                    e: Phaser.Input.Keyboard.KeyCodes.E
                });
                
                // Set up groups for apples and enemies
                apples = this.physics.add.group();
                enemies = this.physics.add.group();
                
                // Spawn first apple
                spawnApple(this);
                
                // Health display
                healthText = this.add.text(5, 5, 'Apples: 0', { 
                    fontSize: '10px', 
                    fill: '#fff',
                    backgroundColor: '#000',
                    padding: { x: 2, y: 2 }
                });
                
                // Set up collisions
                this.physics.add.overlap(wizard, apples, collectApple, null, this);
                this.physics.add.overlap(wizard, enemies, hitEnemy, null, this);
                
                // Create particle emitter
                particles = this.add.particles('particle');
                
                // Setup joystick for Android
                if (isAndroid) {
                    setupJoystick();
                }
                
                // Setup victory and defeat screens
                victoryScreen = this.add.container(82, 82).setAlpha(0);
                let victoryBg = this.add.rectangle(0, 0, 164, 164, 0x000000, 0.8);
                let victoryText = this.add.text(0, 0, 'All wizards\nare powerful', { 
                    fontSize: '16px', 
                    fill: '#fff',
                    align: 'center'
                }).setOrigin(0.5);
                victoryScreen.add([victoryBg, victoryText]);
                
                defeatScreen = this.add.container(82, 82).setAlpha(0);
                let defeatBg = this.add.rectangle(0, 0, 164, 164, 0x000000, 0.8);
                let defeatText = this.add.text(0, 0, 'Victory\nThe monsters\nhave won', { 
                    fontSize: '16px', 
                    fill: '#fff',
                    align: 'center'
                }).setOrigin(0.5);
                defeatScreen.add([defeatBg, defeatText]);
            }
            
            function update() {
                if (gameOver) return;
                
                // Movement controls
                wizard.setVelocity(0);
                
                if (cursors.left.isDown || wasdKeys.left.isDown || joystick.isActive && joystick.x < -10) {
                    wizard.setVelocityX(-100);
                    wizard.anims.play('left', true);
                } else if (cursors.right.isDown || wasdKeys.right.isDown || joystick.isActive && joystick.x > 10) {
                    wizard.setVelocityX(100);
                    wizard.anims.play('right', true);
                }
                
                if (cursors.up.isDown || wasdKeys.up.isDown || joystick.isActive && joystick.y < -10) {
                    wizard.setVelocityY(-100);
                    if (!cursors.left.isDown && !cursors.right.isDown && !wasdKeys.left.isDown && !wasdKeys.right.isDown && 
                        !(joystick.isActive && (joystick.x < -10 || joystick.x > 10))) {
                        wizard.anims.play('up', true);
                    }
                } else if (cursors.down.isDown || wasdKeys.down.isDown || joystick.isActive && joystick.y > 10) {
                    wizard.setVelocityY(100);
                    if (!cursors.left.isDown && !cursors.right.isDown && !wasdKeys.left.isDown && !wasdKeys.right.isDown && 
                        !(joystick.isActive && (joystick.x < -10 || joystick.x > 10))) {
                        wizard.anims.play('down', true);
                    }
                }
                
                // Make sure wizard stays in the game bounds
                wizard.x = Phaser.Math.Clamp(wizard.x, 0, 164);
                wizard.y = Phaser.Math.Clamp(wizard.y, 0, 164);
            }
            
            function spawnApple(scene) {
                const x = Phaser.Math.Between(10, 154);
                const y = Phaser.Math.Between(10, 154);
                const apple = apples.create(x, y, 'apple');
                apple.setScale(0.1);
            }
            
            function spawnEnemy(scene) {
                const x = Phaser.Math.Between(10, 154);
                const y = Phaser.Math.Between(10, 154);
                const enemyType = Phaser.Math.Between(0, 1) === 0 ? 'redBlock' : 'greenBlock';
                const enemy = enemies.create(x, y, enemyType);
                enemy.setScale(0.5);
                
                // Random movement
                scene.tweens.add({
                    targets: enemy,
                    x: Phaser.Math.Between(10, 154),
                    y: Phaser.Math.Between(10, 154),
                    duration: 2000,
                    yoyo: true,
                    repeat: -1
                });
            }
            
            function collectApple(wizard, apple) {
                // Destroy the apple
                apple.destroy();
                
                // Update health/score
                health++;
                healthText.setText('Apples: ' + health);
                
                // Particle effect
                this.particles.createEmitter({
                    x: apple.x,
                    y: apple.y,
                    speed: { min: -50, max: 50 },
                    angle: { min: 0, max: 360 },
                    scale: { start: 1, end: 0 },
                    lifespan: 500,
                    quantity: 10
                });
                
                // Spawn a new apple
                spawnApple(this);
                
                // Spawn an enemy
                spawnEnemy(this);
                
                // Check for victory
                if (health >= 10) {
                    victory(this);
                }
            }
            
            function hitEnemy(wizard, enemy) {
                if (gameOver) return;
                
                // Game over - defeat
                gameOver = true;
                
                // Stop all enemies
                enemies.getChildren().forEach(function(enemy) {
                    if (enemy.body) {
                        enemy.body.setVelocity(0);
                    }
                    if (enemy.timeline) {
                        enemy.timeline.pause();
                    }
                });
                
                // Stop wizard
                wizard.setVelocity(0);
                wizard.anims.stop();
                
                // Death particles
                this.particles.createEmitter({
                    x: wizard.x,
                    y: wizard.y,
                    speed: { min: -100, max: 100 },
                    angle: { min: 0, max: 360 },
                    scale: { start: 1, end: 0 },
                    lifespan: 1000,
                    quantity: 30
                });
                
                // Show defeat screen
                this.tweens.add({
                    targets: defeatScreen,
                    alpha: 1,
                    duration: 1000
                });
            }
            
            function victory(scene) {
                if (gameOver) return;
                
                // Game over - victory
                gameOver = true;
                
                // Stop all enemies
                enemies.getChildren().forEach(function(enemy) {
                    if (enemy.body) {
                        enemy.body.setVelocity(0);
                    }
                    if (enemy.timeline) {
                        enemy.timeline.pause();
                    }
                });
                
                // Stop wizard
                wizard.setVelocity(0);
                wizard.anims.stop();
                
                // Rainbow background
                const rainbow = scene.add.rectangle(82, 82, 164, 164, 0xff0000);
                scene.tweens.add({
                    targets: rainbow,
                    fillColor: { from: 0xff0000, to: 0xffff00 },
                    yoyo: true,
                    duration: 1000,
                    repeat: -1
                });
                rainbow.setDepth(-1);
                
                // Victory particles
                scene.particles.createEmitter({
                    x: { min: 0, max: 164 },
                    y: { min: 0, max: 164 },
                    speed: { min: 20, max: 50 },
                    angle: { min: 0, max: 360 },
                    scale: { start: 1, end: 0 },
                    lifespan: 2000,
                    quantity: 1,
                    frequency: 100
                });
                
                // Show victory screen
                scene.tweens.add({
                    targets: victoryScreen,
                    alpha: 1,
                    duration: 1000
                });
            }
            
            function setupJoystick() {
                const joystickElement = document.querySelector('.joystick');
                const knob = document.querySelector('.joystick-knob');
                
                joystickElement.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    joystick.isActive = true;
                    updateJoystick(e);
                });
                
                joystickElement.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                    updateJoystick(e);
                });
                
                joystickElement.addEventListener('touchend', function(e) {
                    joystick.isActive = false;
                    joystick.x = 0;
                    joystick.y = 0;
                    knob.style.transform = `translate(0px, 0px)`;
                });
                
                function updateJoystick(e) {
                    const touch = e.touches[0];
                    const rect = joystickElement.getBoundingClientRect();
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    
                    let x = touch.clientX - rect.left - centerX;
                    let y = touch.clientY - rect.top - centerY;
                    
                    // Limit to joystick bounds
                    const distance = Math.sqrt(x * x + y * y);
                    const maxDistance = 30;
                    
                    if (distance > maxDistance) {
                        x = (x / distance) * maxDistance;
                        y = (y / distance) * maxDistance;
                    }
                    
                    knob.style.transform = `translate(${x}px, ${y}px)`;
                    
                    joystick.x = x;
                    joystick.y = y;
                }
            }
        }
    </script>
</body>
</html>
